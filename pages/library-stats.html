<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Stats - Reading Tools Hub</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-brand">ğŸ“š Reading Tools</a>
            <div class="nav-links">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="book-picker.html" class="nav-link">Book Picker</a>
                <a href="library-stats.html" class="nav-link active">Library Stats</a>
                <a href="book-bracket.html" class="nav-link">Book Bracket</a>
            </div>
            <div class="theme-selector">
                <button class="theme-btn" id="theme-btn" title="Change theme">ğŸ¨</button>
                <div class="theme-dropdown" id="theme-dropdown">
                    <button class="theme-option" data-theme="forest">ğŸŒ² Forest Green</button>
                    <button class="theme-option" data-theme="ocean">ğŸŒŠ Ocean Blue</button>
                    <button class="theme-option" data-theme="sunset">ğŸŒ… Sunset Peach</button>
                    <button class="theme-option" data-theme="lavender">ğŸ’œ Lavender</button>
                    <button class="theme-option" data-theme="sage">ğŸƒ Sage</button>
                    <button class="theme-option" data-theme="canary">ğŸ¤ Canary</button>
                </div>
            </div>
        </div>
    </nav>
    <script src="../assets/js/theme.js"></script>

    <div class="container">
        <!-- Page Header -->
        <header class="page-header">
            <div class="book-emoji">ğŸ“Š</div>
            <h1>Library Stats</h1>
            <p class="tagline">Discover insights about your reading collection</p>
        </header>

        <!-- Upload Section -->
        <section id="upload-section" class="section active">
            <h2>Upload Your Library</h2>
            
            <!-- Show if CSV already loaded -->
            <div id="csv-loaded-notice" class="csv-loaded-notice" style="display: none;">
                <p class="csv-loaded-text">âœ… CSV already loaded: <strong id="loaded-csv-name"></strong></p>
                <div class="csv-options">
                    <button id="use-existing-csv-btn" class="btn btn-primary">Use This CSV</button>
                    <button id="upload-different-csv-btn" class="btn btn-outline">Upload Different CSV</button>
                </div>
            </div>

            <!-- Upload zone -->
            <div id="upload-zone-container">
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">ğŸ“–</div>
                    <p class="upload-text">Drag & drop your CSV file here</p>
                    <p class="upload-subtext">or</p>
                    <label for="file-input" class="btn btn-primary">Choose File</label>
                    <input type="file" id="file-input" accept=".csv" hidden>
                </div>
                <p class="file-name" id="file-name"></p>
            </div>
        </section>

        <!-- Stats Section -->
        <section id="stats-section" class="section">
            <div class="section-header-with-actions">
                <h2>Your Library Insights</h2>
                <button id="download-stats-btn" class="btn btn-secondary download-btn">
                    <span class="download-icon">ğŸ“¥</span> Download Stats
                </button>
            </div>
            
            <!-- Stats Content (for download) -->
            <div id="stats-content">
                <!-- Overview Stats -->
                <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“š</div>
                    <div class="stat-number" id="total-books">0</div>
                    <div class="stat-label">Total Books</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">âœ…</div>
                    <div class="stat-number" id="books-read">0</div>
                    <div class="stat-label">Books Read</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“–</div>
                    <div class="stat-number" id="books-tbr">0</div>
                    <div class="stat-label">To Be Read</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“„</div>
                    <div class="stat-number" id="total-pages">0</div>
                    <div class="stat-label">Total Pages</div>
                </div>
                <!-- Rating stats (shown only if ratings exist) -->
                <div class="stat-card" id="avg-rating-card" style="display: none;">
                    <div class="stat-icon">â­</div>
                    <div class="stat-number" id="avg-rating">0</div>
                    <div class="stat-label">Average Rating</div>
                </div>
                <div class="stat-card" id="rated-books-card" style="display: none;">
                    <div class="stat-icon">ğŸŒŸ</div>
                    <div class="stat-number" id="rated-books">0</div>
                    <div class="stat-label">Rated Books</div>
                </div>
            </div>

            <!-- Filter Toggle -->
            <div class="stats-filter-toggle">
                <p class="toggle-label">Show stats for:</p>
                <div class="toggle-buttons">
                    <button class="toggle-btn active" data-filter="all">All Books</button>
                    <button class="toggle-btn" data-filter="read">Read Only</button>
                    <button class="toggle-btn" data-filter="unread">Unread Only</button>
                </div>
            </div>

            <!-- Top Lists -->
            <div class="top-lists" id="top-lists">
                <div class="top-list-card">
                    <h3>ğŸ“š Top Genres/Categories</h3>
                    <div id="top-genres" class="top-list"></div>
                </div>
                
                <div class="top-list-card">
                    <h3>âœï¸ Top Authors</h3>
                    <div id="top-authors" class="top-list"></div>
                </div>
                
                <div class="top-list-card">
                    <h3>ğŸ·ï¸ Popular Tags</h3>
                    <div id="top-tags" class="top-list"></div>
                </div>
                
                <!-- Top Rated Books (shown only if ratings exist) -->
                <div class="top-list-card" id="top-rated-card" style="display: none;">
                    <h3>â­ Highest Rated Books</h3>
                    <div id="top-rated" class="top-list"></div>
                </div>
            </div>
            </div>

            <button id="analyze-again-btn" class="btn btn-secondary">Analyze Another File</button>
        </section>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title"></h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <footer class="footer">
        <p>Made with <span id="footer-heart">ğŸ’š</span> for book lovers everywhere</p>
    </footer>

    <script src="../assets/js/library-stats.js"></script>
</body>
</html>
